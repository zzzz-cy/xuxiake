{"version":3,"file":"useOverlayInnerStyle.js","sources":["../../src/select-input/useOverlayInnerStyle.ts"],"sourcesContent":["import { ref, toRefs, computed, CSSProperties } from 'vue';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { TdSelectInputProps } from './type';\nimport { TdPopupProps, PopupVisibleChangeContext } from '../popup';\nimport { useDisabled } from '../hooks/useDisabled';\nimport { useReadonly } from '../hooks/useReadonly';\n\nexport type overlayInnerStyleProps = Pick<\n  TdSelectInputProps,\n  'popupProps' | 'autoWidth' | 'readonly' | 'onPopupVisibleChange' | 'disabled' | 'allowInput' | 'popupVisible'\n>;\n\n// 单位：px\nconst MAX_POPUP_WIDTH = 1000;\n// 避免因滚动条出现文本省略，预留宽度 8\nconst RESERVE_WIDTH = 0;\n\nexport default function useOverlayInnerStyle(props: overlayInnerStyleProps) {\n  const { popupProps, autoWidth } = toRefs(props);\n  const innerPopupVisible = ref(false);\n  const disable = useDisabled();\n  const isReadonly = useReadonly();\n\n  const matchWidthFunc = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    const SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? RESERVE_WIDTH : 0;\n    const width =\n      popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth\n        ? popupElement.offsetWidth\n        : triggerElement.offsetWidth;\n    let otherOverlayInnerStyle: CSSProperties = {};\n    if (\n      popupProps.value &&\n      typeof popupProps.value.overlayInnerStyle === 'object' &&\n      !popupProps.value.overlayInnerStyle.width\n    ) {\n      otherOverlayInnerStyle = popupProps.value.overlayInnerStyle;\n    }\n    return {\n      width: `${Math.min(width, MAX_POPUP_WIDTH)}px`,\n      ...otherOverlayInnerStyle,\n    };\n  };\n\n  const onInnerPopupVisibleChange = (visible: boolean, ctx: PopupVisibleChangeContext) => {\n    if (disable.value || isReadonly.value) return;\n    // 如果点击触发元素（输入框）且为可输入状态，则继续显示下拉框\n    const newVisible = ctx.trigger === 'trigger-element-click' && props.allowInput ? true : visible;\n    // 重复点击触发元素时，下拉框展示状态不变，不重复触发事件\n    if (props.popupVisible !== newVisible) {\n      innerPopupVisible.value = newVisible;\n      props.onPopupVisibleChange?.(newVisible, ctx);\n    }\n  };\n\n  const getAutoWidthPopupStyleWidth = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    return {\n      width: `${Math.max(triggerElement.offsetWidth, popupElement.offsetWidth)}px`,\n      ...popupProps.value?.overlayInnerStyle,\n    };\n  };\n\n  const tOverlayInnerStyle = computed(() => {\n    let result: TdPopupProps['overlayInnerStyle'] = {};\n    const overlayInnerStyle = popupProps.value?.overlayInnerStyle || {};\n    if (isFunction(overlayInnerStyle) || (isObject(overlayInnerStyle) && overlayInnerStyle.width)) {\n      result = overlayInnerStyle;\n    } else {\n      if (autoWidth.value) {\n        result = getAutoWidthPopupStyleWidth;\n      } else {\n        result = matchWidthFunc;\n      }\n    }\n    return result;\n  });\n\n  return {\n    tOverlayInnerStyle,\n    innerPopupVisible,\n    onInnerPopupVisibleChange,\n  };\n}\n"],"names":["MAX_POPUP_WIDTH","RESERVE_WIDTH","useOverlayInnerStyle","props","_toRefs","toRefs","popupProps","autoWidth","innerPopupVisible","ref","disable","useDisabled","isReadonly","useReadonly","matchWidthFunc","triggerElement","popupElement","SCROLLBAR_WIDTH","scrollHeight","offsetHeight","width","offsetWidth","otherOverlayInnerStyle","value","_typeof","overlayInnerStyle","_objectSpread","concat","Math","min","onInnerPopupVisibleChange","visible","ctx","newVisible","trigger","allowInput","popupVisible","_props$onPopupVisible","onPopupVisibleChange","call","getAutoWidthPopupStyleWidth","_popupProps$value","max","tOverlayInnerStyle","computed","_popupProps$value2","result","isFunction","isObject"],"mappings":"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"}